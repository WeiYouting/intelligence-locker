# 智慧储柜项目简介


**功能模块分析图 **


![image](http://www.writingv.site/static/intellegence-locker-function.png)

**网站站点**：http://www.writingv.site

**Java后端框架**：SpringBoot、Mybatis

**缓存**：Redis

**数据库**：MySQL  

**部署**：腾讯云服务器、Nginx、Docker



## 涉及知识点

1. **application.yml**配置日志、数据源、缓存等
2. 设计**rest**风格接口接受请求并响应
3. 使用**imageio**生成图片验证码
4. 使用**jwt**生成token
5. 使用**redis**缓存token
6. 使用**mvc**拦截器过滤请求,判断用户是否登录
7. 使用**aop**记录日志、配合自定义注解校验用户权限是否合法
8. 使用全局异常通知**RestControllerAdvice**处理异常
9. 使用**PageHelper**分页
10. 使用**MyBatis**作为持久层框架
11. 使用jdk8新特性**stream**流处理数据
12. 使用**docker-compose**构建镜像



- - -

### 模块分析

+ #### 用户模块

  - 注册功能
    * 传入手机号、用户名、密码、短信验证码。通过正则校验参数 通过缓存**redis**校验短信验证码
  - 登录功能
    * 传入手机号、密码、短信验证码。若密码为空时校验短信验证码，否则校验密码。若用户不存在则自动注册，分配随机用户名及空密码
  - 登出功能
    * 根据当前请求头中的token获取手机号，移除**redis**中缓存的token
  - 修改用户名功能
    * 传入新的用户名，通过正则校验是否合法 
  - 修改密码功能
    * 传入手机号、旧密码、新密码，若旧密码为空则直接更新密码，否则校验旧密码是否正确
  - 重置密码功能
    * 传入手机号、验证码、新密码，校验短信验证码是否正确




+ #### 顾客模块

  - 查询订单功能
    * 根据token中保存的用户信息获取手机号，通过手机号查询所有订单
  - 查找未完成订单功能
    * 根据token中保存的用户信息获取手机号，通过手机号查询未取货的订单
  - 取货功能
    * 根据token中保存的用户信息获取手机号，通过手机号查询已到达站点的订单并获取柜号，返回柜号id，重置储柜状态




+ #### 骑手模块

  - 查找可接订单功能
    * 传入城市，根据城市查询状态为已创建的订单
  - 接单功能
    * 传入订单id，校验订单id是否合法，是否被其他骑手接单
  - 更新订单状态功能
    * 传入订单id、订单状态，校验订单状态是否合法，若订单状态为已到达站点，则获取当前储柜为空的号码并返回




+ #### 订单模块

  - 查询站点id功能
    * 传入省份、城市、地址，搜索附近的站点
  - 创建订单功能
    * 传入站点id、手机号，使用token中的用户信息获取手机号并创建订单
  - 查找订单功能
    * 传入订单id、骑手、顾客、状态、时间节点、省份、城市、站点，筛选符合条件的订单
   - 查询所有订单功能




+ #### 站点管理员模块

  - 添加骑手功能

  - 移除骑手功能

  - 查询骑手功能

  - 查找骑手功能


+ #### 系统管理员模块

  - 查询所有用户功能

  - 查找用户功能
    * 通过手机号查找用户
  - 添加站点管理员功能

  - 移除站点管理员功能

  - 分配管理站点功能
    * 传入手机号、站点id，更改站点管理员对应站点
  - 查询站点管理员功能

  - 查找站点管理员功能
    * 传入手机号码、省份、城市、站点名称，筛选符合条件的站点管理员



---

### 项目总结

##### 缺陷与不足

1. 没有分模块开发，代码耦合度较高
2. 数据库表字段设计不够合理
3. 站点管理员业务逻辑存在bug 
4. 缓存的使用不够合理，没有使用到缓存优化查询效率
5. 没有使用到消息队列提高接口响应速度
6. 记录日志设计不够合理
